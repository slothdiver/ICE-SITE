<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>In Case of Emergency (ICE)</title>
  <meta name="description" content="Private ICE information sheet" />
  <style>
    :root{
      --bg:#0f172a;/* slate-900 */
      --panel:#111827;/* gray-900 */
      --muted:#94a3b8;/* slate-400 */
      --text:#e5e7eb;/* gray-200 */
      --accent:#22d3ee;/* cyan-400 */
      --danger:#ef4444;/* red-500 */
      --ok:#10b981;/* emerald-500 */
      --card:#0b1220;
      --field:#0b1220;
      --ring: #22d3ee55;
    }
    html,body{height:100%;}
    body{margin:0;background:linear-gradient(180deg,var(--bg),#020617);color:var(--text);font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Inter,Helvetica,Arial,sans-serif}
    .wrap{max-width:980px;margin:0 auto;padding:24px}
    .card{background:linear-gradient(180deg,#0b1220, #0a0f1a);border:1px solid #1f2937;border-radius:16px;box-shadow:0 10px 30px #0008}
    header{display:flex;gap:12px;align-items:center;justify-content:space-between;padding:20px 24px;border-bottom:1px solid #1f2937}
    header h1{font-size:20px;margin:0;letter-spacing:0.2px}
    .badge{font-size:12px;border:1px solid #334155;color:#cbd5e1;padding:4px 8px;border-radius:999px}
    .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:16px}
    .controls{display:flex;flex-wrap:wrap;gap:8px}
    button,.btn{cursor:pointer;background:#0b1326;border:1px solid #23324a;color:#e2e8f0;padding:10px 12px;border-radius:10px}
    button:hover,.btn:hover{border-color:#2f465f}
    .btn-primary{background:linear-gradient(180deg,#042e3b,#05232c);border-color:#1d6170;color:#e6fffb}
    .btn-danger{background:linear-gradient(180deg,#3b0a0a,#2a0707);border-color:#7f1d1d;color:#fecaca}
    .btn-ok{background:linear-gradient(180deg,#08301f,#08261a);border-color:#065f46;color:#d1fae5}

    .section{padding:16px 24px}
    .section h2{margin:8px 0 12px;font-size:14px;color:var(--muted);text-transform:uppercase;letter-spacing:1px}
    .field{display:flex;flex-direction:column;gap:6px}
    .field label{font-size:13px;color:#cbd5e1}
    .field input,.field textarea, .field select{background:var(--field);border:1px solid #23324a;color:#e5e7eb;border-radius:10px;padding:10px 12px;outline:none}
    .field input:focus,.field textarea:focus,.field select:focus{box-shadow:0 0 0 3px var(--ring)}
    .col-6{grid-column:span 6}
    .col-12{grid-column:span 12}
    .two{grid-template-columns:repeat(2,1fr)}
    .muted{color:var(--muted)}
    .divider{height:1px;background:#1f2937;margin:8px 0 16px}

    .gate{max-width:420px;margin:15vh auto 0;padding:24px}
    .gate h1{font-size:22px;margin:0 0 6px}
    .hint{font-size:12px;color:#a5b4fc}

    @media print{
      body{background:#fff}
      .card, header, .controls{box-shadow:none;border:none}
      .controls, .gate{display:none!important}
      .wrap{padding:0}
      .section{padding:8px 0}
      .field input,.field textarea,.field select{border:1px solid #cbd5e1;color:#000;background:#fff}
      a::after{content:" (" attr(href) ")"}
    }
  </style>
</head>
<body>
  <!-- Password Gate -->
  <div id="gate" class="wrap">
    <div class="card gate">
      <h1>Enter site password</h1>
      <p class="muted">Client‑side only. Use for light privacy, not strong security.</p>
      <div class="divider"></div>
      <div class="grid" style="grid-template-columns:1fr auto;gap:8px">
        <input id="gateInput" type="password" placeholder="Password" autocomplete="current-password" />
        <button id="gateBtn" class="btn btn-primary">Unlock</button>
      </div>
      <p id="gateMsg" class="muted" style="margin-top:8px"></p>
    </div>
  </div>

  <!-- Main App -->
  <div id="app" style="display:none">
    <div class="wrap">
      <div class="card">
        <header>
          <h1>In Case of Emergency (ICE) <span class="badge">Private</span></h1>
          <div class="controls">
            <button id="printBtn" class="btn">Print / PDF</button>
            <button id="exportBtn" class="btn">Export JSON</button>
            <label class="btn">
              <input id="importFile" type="file" accept="application/json" style="display:none" />
              Import JSON
            </label>
            <button id="clearBtn" class="btn btn-danger">Clear All</button>
            <button id="lockBtn" class="btn btn-primary">Lock</button>
          </div>
        </header>

        <div class="section">
          <h2>Personal Information</h2>
          <div class="grid">
            <div class="field col-6"><label>Full name</label><input id="fullName"/></div>
            <div class="field col-6"><label>Date of birth</label><input id="dob" type="date"/></div>
            <div class="field col-12"><label>Address</label><input id="address"/></div>
            <div class="field col-6"><label>Phone number</label><input id="phone"/></div>
            <div class="field col-6"><label>Email</label><input id="email" type="email"/></div>
          </div>
        </div>

        <div class="section">
          <h2>Emergency Contact</h2>
          <div class="grid">
            <div class="field col-6"><label>Contact name</label><input id="ecName"/></div>
            <div class="field col-6"><label>Relationship</label><input id="ecRel"/></div>
            <div class="field col-6"><label>Phone</label><input id="ecPhone"/></div>
            <div class="field col-6"><label>Alternate phone</label><input id="ecAlt"/></div>
          </div>
        </div>

        <div class="section">
          <h2>Medical Information</h2>
          <div class="grid">
            <div class="field col-4"><label>Blood type</label>
              <select id="blood">
                <option value="">Select</option>
                <option>A+</option><option>A-</option>
                <option>B+</option><option>B-</option>
                <option>AB+</option><option>AB-</option>
                <option>O+</option><option>O-</option>
                <option>Unknown</option>
              </select>
            </div>
            <div class="field col-8"><label>Allergies (food, drug, environmental)</label><input id="allergies"/></div>
            <div class="field col-12"><label>Current medications (name, dose, frequency)</label><textarea id="meds" rows="3"></textarea></div>
            <div class="field col-12"><label>Medical conditions</label><textarea id="conditions" rows="3"></textarea></div>
            <div class="field col-6"><label>Primary care physician</label><input id="pcp" placeholder="Name, phone"/></div>
            <div class="field col-6"><label>Specialist(s)</label><input id="specialists" placeholder="Name(s), phone(s)"/></div>
            <div class="field col-12"><label>Past surgeries / significant history</label><textarea id="history" rows="2"></textarea></div>
          </div>
        </div>

        <div class="section">
          <h2>Insurance & ID</h2>
          <div class="grid">
            <div class="field col-6"><label>Insurance provider</label><input id="insProvider"/></div>
            <div class="field col-6"><label>Policy number</label><input id="policy"/></div>
            <div class="field col-6"><label>ID / Driver’s license</label><input id="dl"/></div>
            <div class="field col-6"><label>Preferred hospital</label><input id="hospital"/></div>
          </div>
        </div>

        <div class="section">
          <h2>Directives & Other</h2>
          <div class="grid">
            <div class="field col-6"><label>Advance directive / DNR</label><input id="dnr" placeholder="Yes/No, where stored"/></div>
            <div class="field col-6"><label>Organ donor</label>
              <select id="donor">
                <option value="">Select</option>
                <option>Yes</option>
                <option>No</option>
                <option>Unknown</option>
              </select>
            </div>
            <div class="field col-12"><label>Special needs or accommodations</label><textarea id="needs" rows="2"></textarea></div>
            <div class="field col-12"><label>Pets / dependents to notify or care for</label><textarea id="pets" rows="2"></textarea></div>
            <div class="field col-12"><label>Notes</label><textarea id="notes" rows="3"></textarea></div>
          </div>
        </div>

      </div>
      <p class="muted" style="margin:12px 4px">Autosaves locally in your browser. Export JSON for backup. Client‑side password is not strong security.</p>
    </div>
  </div>

<script>
(function(){
  // ======== Config ========
  const SITE_PASSWORD = "ice2025"; // <- change this
  const STORAGE_KEY = "ice_sheet_v1";
  const HIDE_KEYS_FOR_PRINT = []; // keep visible by default

  // ======== Gate ========
  const gate = document.getElementById('gate');
  const app = document.getElementById('app');
  const gateInput = document.getElementById('gateInput');
  const gateBtn = document.getElementById('gateBtn');
  const gateMsg = document.getElementById('gateMsg');

  function openApp(){ gate.style.display='none'; app.style.display='block'; }
  gateBtn.addEventListener('click',()=>{
    const ok = gateInput.value === SITE_PASSWORD;
    if(ok){ openApp(); } else { gateMsg.textContent = 'Incorrect password'; }
  });
  gateInput.addEventListener('keydown',e=>{ if(e.key==='Enter'){ gateBtn.click(); }});

  // If password cached in this session (very light), allow quick reopen
  try{ if(sessionStorage.getItem('ice_unlocked')==='1'){ openApp(); }}catch(e){}
  function rememberUnlock(){ try{ sessionStorage.setItem('ice_unlocked','1'); }catch(e){} }
  gateBtn.addEventListener('click', rememberUnlock);

  // ======== Data binding ========
  const ids = [
    'fullName','dob','address','phone','email','ecName','ecRel','ecPhone','ecAlt',
    'blood','allergies','meds','conditions','pcp','specialists','history',
    'insProvider','policy','dl','hospital','dnr','donor','needs','pets','notes'
  ];

  const nodes = Object.fromEntries(ids.map(id=>[id, document.getElementById(id)]));

  function load(){
    try{
      const raw = localStorage.getItem(STORAGE_KEY);
      if(!raw) return;
      const data = JSON.parse(raw);
      ids.forEach(id=>{ if(nodes[id] && data[id]!=null){ nodes[id].value = data[id]; }});
    }catch(e){ console.warn('load failed', e); }
  }
  function save(){
    const data = {};
    ids.forEach(id=>{ data[id] = nodes[id]?.value ?? ''; });
    try{ localStorage.setItem(STORAGE_KEY, JSON.stringify(data)); }catch(e){ console.warn('save failed', e); }
  }
  function clearAll(){
    if(!confirm('Clear all fields?')) return;
    ids.forEach(id=>{ if(nodes[id]) nodes[id].value=''; });
    save();
  }

  ids.forEach(id=>{
    const el = nodes[id];
    if(!el) return;
    el.addEventListener('input', save);
    el.addEventListener('change', save);
  });
  load();

  // ======== Controls ========
  document.getElementById('printBtn').addEventListener('click', ()=>{
    window.print();
  });

  document.getElementById('exportBtn').addEventListener('click', ()=>{
    const data = {};
    ids.forEach(id=> data[id]=nodes[id]?.value ?? '');
    const blob = new Blob([JSON.stringify(data,null,2)], {type:'application/json'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = `ICE_${(nodes.fullName?.value||'data').replace(/\s+/g,'_')}.json`;
    a.click();
  });

  document.getElementById('importFile').addEventListener('change', (e)=>{
    const file = e.target.files?.[0];
    if(!file) return;
    const reader = new FileReader();
    reader.onload = ()=>{
      try{
        const data = JSON.parse(reader.result);
        ids.forEach(id=>{ if(nodes[id] && data[id]!=null){ nodes[id].value = data[id]; }});
        save();
        alert('Import complete.');
      }catch(err){ alert('Import failed. Not valid JSON.'); }
    };
    reader.readAsText(file);
  });

  document.getElementById('clearBtn').addEventListener('click', clearAll);

  document.getElementById('lockBtn').addEventListener('click', ()=>{
    if(confirm('Lock and return to password screen?')){ app.style.display='none'; gate.style.display='block'; gateInput.value=''; gateInput.focus(); try{ sessionStorage.removeItem('ice_unlocked'); }catch(e){} }
  });
})();
</script>
</body>
</html>
